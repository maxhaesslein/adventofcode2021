<!DOCTYPE html><html><head><meta charset="utf-8"/>
<script type="text/javascript">

function prepareInput( input ) {

	input = input.split("\n")

	var stride = input[0].length;
	var input = {
		stride: stride,
		map: input.join('')
	}

	return input;
}

function answer1( input ) {

	var stride = input.stride,
		map = input.map,
		start = 0
		targetIndex = map.length-1,
		trackedCosts = new Array(map.length),
		processedNodes = [0];

	trackedCosts[1] = parseInt(map[1], 10);
	trackedCosts[stride] = parseInt(map[stride], 10);
	trackedCosts[targetIndex] = Infinity;

	var nodeIndex = findLowestCostNode( trackedCosts, processedNodes );

	var count = 0;
	while( nodeIndex ) {
		var costToReachNode = trackedCosts[nodeIndex],
			adjacentNodes = getAdjacentPoints( nodeIndex, stride, map.length, processedNodes );

		for( var i = 0; i < adjacentNodes.length; i++ ) {
			var adjacentNodeIndex = adjacentNodes[i];

			if( trackedCosts[adjacentNodeIndex] ) continue;

			var costFromNodeToChild = parseInt(map[adjacentNodeIndex]);

			trackedCosts[adjacentNodeIndex] = costToReachNode + costFromNodeToChild;
		}

		processedNodes.push( nodeIndex );

		nodeIndex = findLowestCostNode( trackedCosts, processedNodes );
	}

	var targetTopIndex = targetIndex-stride,
		targetLeftIndex = targetIndex-1,
		targetCost = parseInt(map[targetIndex], 10);

	var topCost = trackedCosts[targetTopIndex]+targetCost,
		leftCost = trackedCosts[targetLeftIndex]+targetCost;

	if( topCost < leftCost ) return topCost;
	if( leftCost < topCost ) return leftCost;

	console.warn('something went wrong', topCost, leftCost);
}

function answer2( map ) {

	// TODO

	return 'not implemented yet';
}

function getAdjacentPoints( index, stride, mapLength, processedNodes ){

	var points = [];

	// check left point
	if( index%stride != 0 && index >= 0 && processedNodes.indexOf(index-1) === -1 ) {
		points.push(index-1);
	}

	// check right point
	if( index%stride != stride-1 && index < mapLength && processedNodes.indexOf(index+1) === -1 ) {
		points.push(index+1);
	}

	// check bottom point
	if( index+stride < mapLength && processedNodes.indexOf(index+stride) === -1 ) {
		points.push(index+stride);
	}

	// check top point
	if( index-stride >= 0 && processedNodes.indexOf(index-stride) === -1 ) {
		points.push(index-stride);
	}

	return points;
}

function findLowestCostNode( lowestCostNodes, processedNodes ) {

	var lowestCostIndex = false,
		lowestCost = Infinity;

	for( index in lowestCostNodes ) {

		index = parseInt( index, 10 );

		if( processedNodes.indexOf(index) !== -1 ) continue;

		var nodeCost = lowestCostNodes[index];

		if( nodeCost >= lowestCost ) continue;

		lowestCostIndex = index;
		lowestCost = nodeCost;
	}

	return lowestCostIndex;
}




function getInput() {
	var textArea = document.getElementById('input');
	var input = textArea.value;

	if( ! input ) console.log("please provide an input");

	return input;
}
window.addEventListener('load',function(){
	var output = document.getElementById('output');
	document.getElementById('start').addEventListener('click', function(){
		var input = prepareInput(getInput());

		console.time('answer1');
		output.innerHTML = "Answer 1: "+answer1(input);
		console.timeEnd('answer1');

		console.time('answer2');
		output.innerHTML += "\nAnswer 2: "+answer2(input);
		console.timeEnd('answer2');
	});
});
</script>
<style>
pre {
	background: #eee;
	min-height: 2em;
}
</style>
</head>
<body>
<pre id="output"></pre>
<textarea id="input"></textarea>
<button id="start">start</button>
(Takes a long time because of not optimized code)
</body></html>
